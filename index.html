<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>CAT CULT</title>
  <link rel="icon" type="image/png" href="rigby.png">
  <style>
    html, body {
      height: 100%;
      margin: 0;
      padding: 0;
    }
    body {
      min-height: 100vh;
      min-width: 100vw;
      background: url('Windows-XP-4K-modified-scaled.jpg') no-repeat center center fixed;
      background-size: cover;
      overflow-x: hidden;
      font-family: Arial, Helvetica, sans-serif;
    }
    .header {
      width: 100%;
      text-align: center;
      margin-top: 48px;
    }
    .title {
      font-size: 4rem;
      font-weight: bold;
      color: #222;
      letter-spacing: 2px;
      margin-bottom: 16px;
      text-shadow: 0 2px 8px rgba(255,255,255,0.3);
    }
    .ca-text {
      font-size: 1.1rem;
      color: #222;
      margin-bottom: 12px;
      letter-spacing: 1px;
    }
    .copy-btn {
      background: #FFD600;
      color: #222;
      font-weight: bold;
      border: none;
      border-radius: 6px;
      padding: 10px 28px;
      font-size: 1.1rem;
      cursor: pointer;
      margin-bottom: 24px;
      margin-top: 6px;
      transition: background 0.2s;
    }
    .copy-btn:hover {
      background: #ffe066;
    }
    .btn-group {
      margin-top: 18px;
      display: flex;
      justify-content: center;
      gap: 18px;
    }
    .main-btn {
      background: #fff;
      color: #222;
      border: none;
      border-radius: 8px;
      padding: 12px 28px;
      font-size: 1.1rem;
      font-weight: 500;
      cursor: pointer;
      box-shadow: 0 2px 8px rgba(0,0,0,0.07);
      transition: background 0.2s, color 0.2s;
    }
    .main-btn:hover {
      background: #f0f0f0;
    }
    .image-section {
      display: flex;
      justify-content: center;
      align-items: flex-start;
      margin-top: 80px;
      margin-bottom: 80px;
      width: 100%;
      gap: 40px;
    }
    
    .cult-join-section {
      text-align: center;
      margin: 60px 0 40px 0;
    }
    
    .cult-join-title {
      font-size: 3.5rem;
      font-weight: bold;
      color: #222;
      letter-spacing: 3px;
      text-shadow: 0 4px 12px rgba(255,255,255,0.4);
      margin: 0;
      text-transform: uppercase;
    }
    .image-card {
      background: #fff;
      border-radius: 10px;
      box-shadow: 0 4px 32px rgba(0,0,0,0.18);
      padding: 0;
      overflow: hidden;
      display: flex;
      flex-direction: column;
      align-items: center;
      max-width: 420px;
      width: 90vw;
    }
    .image-card img {
      display: block;
      width: 100%;
      height: auto;
      object-fit: cover;
      border-radius: 10px 10px 0 0;
    }
    
    .cat-info {
      padding: 16px;
      text-align: center;
      background: #000;
      border: 3px solid #fff;
      border-top: none;
      border-radius: 0 0 10px 10px;
      box-shadow: 0 4px 16px rgba(0,0,0,0.3);
    }
    
    .cat-info h3 {
      margin: 0 0 8px 0;
      font-size: 1.3rem;
      font-weight: bold;
      color: #fff;
      text-shadow: 0 2px 4px rgba(0,0,0,0.5);
      letter-spacing: 1px;
    }
    
    .cat-info p {
      margin: 0;
      font-size: 0.9rem;
      color: #ccc;
      line-height: 1.3;
    }
    
    .cat-info a {
      color: #FFD600;
      text-decoration: none;
      font-weight: bold;
      text-shadow: 0 1px 2px rgba(0,0,0,0.8);
    }
    
    .cat-info a:hover {
      color: #ffe066;
      text-shadow: 0 2px 4px rgba(0,0,0,0.9);
    }
    .editor-section {
      display: flex;
      flex-direction: column;
      align-items: center;
      margin: 60px 0 100px 0;
    }
    .editor-container {
      background: #000;
      border: 8px solid #fff;
      border-radius: 12px;
      padding: 32px 32px 32px 32px;
      max-width: 1100px;
      width: 95vw;
      box-sizing: border-box;
      display: flex;
      flex-direction: column;
      align-items: center;
      min-height: 700px;
    }
    .editor-card {
      background: transparent;
      border: none;
      border-radius: 0;
      padding: 0;
      display: flex;
      justify-content: center;
      align-items: center;
      width: 100%;
      min-height: 300px;
      margin-bottom: 32px;
    }
    .editor-card img {
      max-width: 350px;
      width: 100%;
      height: auto;
      display: block;
      background: #000;
      border-radius: 4px;
    }
    .editor-btn-group {
      display: flex;
      gap: 32px;
      justify-content: center;
      width: 100%;
      margin-bottom: 24px;
    }
    .editor-btn {
      background: #111;
      color: #fff;
      border: 2px solid #fff;
      border-radius: 4px;
      padding: 16px 64px;
      font-size: 1.1rem;
      font-weight: bold;
      cursor: pointer;
      transition: background 0.2s, color 0.2s;
      letter-spacing: 1px;
    }
    .editor-btn:hover {
      background: #fff;
      color: #111;
    }
    .editor-tabs {
      display: flex;
      justify-content: center;
      gap: 48px;
      margin: 36px 0 18px 0;
      width: 100%;
    }
    .editor-tab {
      color: #fff;
      font-size: 1.5rem;
      font-weight: bold;
      cursor: pointer;
      opacity: 0.7;
      transition: opacity 0.2s;
      padding-bottom: 4px;
      border-bottom: 2px solid transparent;
    }
    .editor-tab.active {
      opacity: 1;
      border-bottom: 2px solid #fff;
    }
    .editor-grid {
      background: transparent;
      border-radius: 0;
      margin: 0 auto;
      max-width: 100%;
      width: 100%;
      padding: 24px 0 0 0;
      box-sizing: border-box;
      margin-top: 12px;
      margin-bottom: 0;
      position: relative;
      min-height: 420px;
      max-height: 520px;
      overflow-y: hidden;
    }
    .editor-grid-title {
      color: #fff;
      font-size: 1.3rem;
      font-weight: bold;
      text-align: center;
      margin-bottom: 18px;
      letter-spacing: 1px;
    }
    .editor-grid-items {
      display: grid;
      grid-template-columns: repeat(5, 1fr);
      gap: 18px;
      justify-items: center;
    }
    .editor-grid-item {
      width: 120px;
      height: 140px;
      border-radius: 10px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.18);
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .editor-grid-item.bg-white {
      background: #fff;
      border: 2px solid #eee;
    }
    .editor-card.white-bg {
      background: #fff !important;
    }
    .zazu-frame-wrapper {
      width: 360px;
      height: 360px;
      border: 5px solid #fff;
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      background: #000;
    }
    .zazu-frame {
      position: relative;
      width: 350px;
      height: 350px;
      background: transparent;
      display: block;
    }
    .zazu-frame.bg-white {
      background: #fff !important;
    }
    .zazu-frame.bg-csgo {
      background: url('backgrounds/csgo-dust-2-map-portion.avif') center center / cover no-repeat !important;
    }
    .zazu-frame.bg-1000yard {
      background: url('backgrounds/i-give-up-can-someone-make-this-have-the-1000-yard-stare-v0-0xk9rgdol35e1.png') center center / cover no-repeat !important;
    }
    .zazu-frame.bg-us15 {
      background: url('backgrounds/US-15.jpg') center center / cover no-repeat !important;
    }
    .zazu-frame.bg-7mjhif {
      background: url('backgrounds/7mjhif166f641.jpg') center center / cover no-repeat !important;
    }
    .zazu-frame.bg-bg1 {
      background: url('backgrounds/bg1.jpg') center center / cover no-repeat !important;
    }
    .zazu-frame.bg-bg2 {
      background: url('backgrounds/bg2.png') center center / cover no-repeat !important;
    }
    .zazu-frame img {
      max-width: 120%;
      max-height: 120%;
      background: transparent !important;
      border-radius: 4px;
      position: absolute;
      bottom: -120px;
      left: -10%;
      width: 120%;
      height: auto;
      /* z-index removed to allow inline z-index to control stacking */
    }
    
    /* Ensure Rigby is positioned at the bottom */
    .zazu-frame img[src*="rigby.png"] {
      bottom: -120px !important;
    }
    
    /* Special styling for zazu.png when it's selected */
    .zazu-frame img[src*="zazu.png"] {
      width: 90% !important;
      max-width: 90% !important;
      left: 8% !important;
      bottom: 38px !important;
    }

    .zazu-frame img[src*="cat3.png"] {
      width: 100% !important;
      max-width: 100% !important;
      left: 0% !important;
      bottom: -5px !important;
    }

    .zazu-frame img[src*="cat4.png"] {
      width: 100% !important;
      max-width: 100% !important;
      left: 0% !important;
      bottom: 30px !important;
    }

    .zazu-frame img[src*="crying.png"] {
      width: 80% !important;
      max-width: 80% !important;
      left: 22% !important;
      bottom: -55px !important;
    }

    .zazu-frame img[src*="cat5.png"] {
      width: 100% !important;
      max-width: 100% !important;
      left: 0% !important;
      bottom: -7px !important;
    }
    

    #editor-eyes[style*="display: none"],
    #editor-hat[style*="display: none"],
    #editor-extras[style*="display: none"] {
      border: none !important;
      background: none !important;
    }
    #editor-eyes {
      position: absolute;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      z-index: 100;
      background: rgba(255,0,0,0.1);
    }
    .eyes-8bit {
      width: 300px !important;
      height: 110px !important;
      left: 55px !important;
      top: 105px !important;
      position: absolute;
      /* border: 2px solid red; */ /* Remove debug border */
      pointer-events: none;
      z-index: 10;
      filter: drop-shadow(0 2px 6px rgba(0,0,0,0.4));
    }
    .eyes-grid-option {
      background: #fff;
      border: 2px solid #ccc;
      border-radius: 8px;
      padding: 4px;
      box-sizing: border-box;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .editor-grid-items#eyes-grid-items {
      /* No overrides: use .editor-grid-items defaults for layout and spacing */
    }
    .editor-grid-item.eyes-grid-option {
      /* Only keep border/background for clarity, but use .editor-grid-item sizing */
      background: #fff;
      border: 2px solid #ccc;
      border-radius: 8px;
      padding: 4px;
    }
    
    /* Special styling for cat selection grid */
    #cat-grid-items {
      display: flex;
      justify-content: center;
      align-items: center;
      flex-wrap: wrap;
      gap: 24px;
      grid-template-columns: unset;
    }
    
    #cat-grid-items .editor-grid-item {
      width: 200px;
      height: 240px;
      border: 3px solid #fff;
      border-radius: 15px;
      transition: transform 0.2s, box-shadow 0.2s;
    }
    
    /* Make Rigby image bigger in the button */
    #cat-rigby-item {
      background-size: 140% !important;
      background-position: center 95% !important;
    }
    
    #cat-grid-items .editor-grid-item:hover {
      transform: scale(1.05);
      box-shadow: 0 8px 25px rgba(255,255,255,0.3);
    }
    
    /* Overlay drag state (hat & eyes) */
    .overlay-draggable {
      cursor: grab !important;
      pointer-events: auto !important;
      outline: 2px dashed rgba(255,214,0,0.7);
      outline-offset: 2px;
    }
    .overlay-dragging {
      cursor: grabbing !important;
      opacity: 0.85;
    }
    .overlay-locked {
      cursor: default !important;
      pointer-events: none !important;
      outline: none;
    }
    #confirm-overlay-btn {
      display: none;
    }
    #confirm-overlay-btn.visible {
      display: block;
    }
    .overlay-ctrl-btn {
      background: #111;
      color: #fff;
      border: 2px solid #555;
      border-radius: 4px;
      padding: 6px 14px;
      font-size: 0.85rem;
      font-weight: bold;
      cursor: pointer;
      letter-spacing: 1px;
      transition: background 0.15s, border-color 0.15s;
    }
    .overlay-ctrl-btn:hover {
      background: #333;
      border-color: #FFD600;
      color: #FFD600;
    }
    #overlay-flip-controls {
      display: none;
      gap: 10px;
      align-items: center;
      justify-content: center;
      padding: 10px 0 4px 0;
      flex-wrap: wrap;
    }
    #overlay-flip-controls.visible { display: flex; }
    .overlay-handle {
      position: absolute;
      z-index: 200;
      pointer-events: auto;
    }
    .overlay-rot-handle {
      width: 16px;
      height: 16px;
      border-radius: 50%;
      background: #FFD600;
      border: 2px solid #000;
      cursor: grab;
      box-shadow: 0 0 0 3px rgba(255,214,0,0.4);
    }
    .overlay-rot-handle:active { cursor: grabbing; }
    .overlay-corner-handle {
      width: 12px;
      height: 12px;
      background: #fff;
      border: 2px solid #FFD600;
      box-shadow: 0 0 0 1px #000;
    }
    #oh-tl { cursor: nw-resize; }
    #oh-tr { cursor: ne-resize; }
    #oh-bl { cursor: sw-resize; }
    #oh-br { cursor: se-resize; }

    /* Ensure cat grid can be hidden by JavaScript */
    #cat-grid-items[style*="display: none"] {
      display: none !important;
    }

  </style>
</head>
<body>
  <div class="header">
    <div class="title">CAT CULT</div>
    <div class="ca-text">Contract address: <span id="ca">TNhXCf4oBnNBdi44JRY693xUSxX3ovTgZqXNDVqpump</span></div>
    <button class="copy-btn" onclick="copyCA()">Copy CA</button>
    <div class="btn-group">
      <button class="main-btn" onclick="window.open('https://x.com/zazucat_DEV', '_blank')">OFFICIAL X</button>
      <button class="main-btn" onclick="window.open('https://x.com/i/communities/2024546184983871591', '_blank')">X-COMMUNITY</button>
      <button class="main-btn" onclick="window.open('https://pump.fun/coin/9QaXyZjjesiQB4BNyuyJvgQyQtH6AAjPHY2czMA8pump', '_blank')">BUY</button>
    </div>
  </div>

  <div class="editor-section">
    <div class="editor-container">
      <div class="editor-card">
        <div class="zazu-frame-wrapper">
          <div id="zazu-frame" class="zazu-frame">
            <img id="editor-zazu" src="rigby.png" alt="Rigby the cat editor" style="position: relative;" />
            <img id="editor-hat" src="" alt="Zazu hat overlay" style="display:none; position:absolute; left:0; top:0; width:100%; height:100%; pointer-events:none; z-index: 30;" />
            <img id="editor-eyes" src="" alt="Zazu eyes overlay" style="display:none; position:absolute; left:0; top:0; width:100%; height:100%; pointer-events:none; z-index: 40;" />
            <img id="editor-extras" src="" alt="Zazu extras overlay" style="display:none; position:absolute; left:0; top:0; width:100%; height:100%; pointer-events:none; z-index: 50;" />
            <div id="overlay-handle-container" style="display:none; position:absolute; z-index:100; left:0;top:0;width:100%;height:100%; pointer-events:none;">
              <div class="overlay-handle overlay-rot-handle" id="oh-rot"></div>
              <div class="overlay-handle overlay-corner-handle" id="oh-tl"></div>
              <div class="overlay-handle overlay-corner-handle" id="oh-tr"></div>
              <div class="overlay-handle overlay-corner-handle" id="oh-bl"></div>
              <div class="overlay-handle overlay-corner-handle" id="oh-br"></div>
            </div>
          </div>
        </div>
      </div>
      <div id="overlay-flip-controls">
        <button class="overlay-ctrl-btn" onclick="flipOverlayH()">&#8644; Flip H</button>
        <button class="overlay-ctrl-btn" onclick="flipOverlayV()">&#8645; Flip V</button>
      </div>
      <div class="editor-btn-group">
        <button class="editor-btn" onclick="resetZazu()">RESET</button>
        <button class="editor-btn" id="confirm-overlay-btn" onclick="confirmOverlay()">CONFIRM</button>
        <button class="editor-btn" onclick="downloadZazu()">DOWNLOAD</button>
      </div>
      <div class="editor-tabs">
        <div class="editor-tab active" data-tab="Cat">Cat</div>
        <div class="editor-tab" data-tab="Background">Background</div>
        <div class="editor-tab" data-tab="Eyes">Eyes</div>
        <div class="editor-tab" data-tab="Hats">Hats</div>
        <div class="editor-tab" data-tab="Extras">Extras</div>
      </div>
      <div class="editor-grid">
        <div class="editor-grid-title" id="editor-grid-title">CAT</div>
        <div class="editor-grid-items" id="cat-grid-items" style="display:block;">
          <div class="editor-grid-item eyes-grid-option" id="cat-rigby-item" style="background: url('rigby.png') center center / contain no-repeat;"></div>
          <div class="editor-grid-item eyes-grid-option" id="cat-zazu-item" style="background: url('zazu.png') center center / contain no-repeat;"></div>
          <div class="editor-grid-item eyes-grid-option" id="cat-cat3-item" style="background: url('cat3.png') center center / contain no-repeat;"></div>
          <div class="editor-grid-item eyes-grid-option" id="cat-cat4-item" style="background: url('cat4.png') center center / contain no-repeat;"></div>
          <div class="editor-grid-item eyes-grid-option" id="cat-cat5-item" style="background: url('cat5.png') center center / contain no-repeat;"></div>
          <div class="editor-grid-item eyes-grid-option" id="cat-crying-item" style="background: url('crying.png') center center / contain no-repeat;"></div>
        </div>
        <div class="editor-grid-items" id="editor-grid-items" style="display:none;">
          <div class="editor-grid-item bg-white" id="bg-white-item"></div>
          <div class="editor-grid-item" id="bg-csgo-item" style="background: url('backgrounds/csgo-dust-2-map-portion.avif') center center / cover no-repeat;"></div>
          <div class="editor-grid-item" id="bg-1000yard-item" style="background: url('backgrounds/i-give-up-can-someone-make-this-have-the-1000-yard-stare-v0-0xk9rgdol35e1.png') center center / cover no-repeat;"></div>
          <div class="editor-grid-item" id="bg-us15-item" style="background: url('backgrounds/US-15.jpg') center center / cover no-repeat;"></div>
          <div class="editor-grid-item" id="bg-7mjhif-item" style="background: url('backgrounds/7mjhif166f641.jpg') center center / cover no-repeat;"></div>
          <div class="editor-grid-item" id="bg-bg1-item" style="background: url('backgrounds/bg1.jpg') center center / cover no-repeat;"></div>
          <div class="editor-grid-item" id="bg-bg2-item" style="background: url('backgrounds/bg2.png') center center / cover no-repeat;"></div>
        </div>
        <!-- Eyes grid, hidden by default -->
        <div class="editor-grid-items" id="eyes-grid-items" style="display:none;">
          <div class="editor-grid-item eyes-grid-option" id="eyes-8bit-item" style="background: url('eyes/8bit-glasses.png') center center / contain no-repeat;"></div>
          <div class="editor-grid-item eyes-grid-option" id="eyes-shuttershades-item" style="background: url('eyes/png-transparent-white-eyewear-shutter-shades-aviator-sunglasses-shutter-s-text-monochrome-glasses-removebg-preview.png') center center / contain no-repeat;"></div>
          <div class="editor-grid-item eyes-grid-option" id="eyes-cloutgoggles-item" style="background: url('eyes/7-79919_cartoon-clout-goggles-transparent-hd-png-download-removebg-preview.png') center center / contain no-repeat;"></div>
          <div class="editor-grid-item eyes-grid-option" id="eyes-vector-item" style="background: url('eyes/pngtree-eye-glass-vector-png-image_4485520-removebg-preview.png') center center / contain no-repeat;"></div>
          <div class="editor-grid-item eyes-grid-option" id="eyes-sport-item" style="background: url('eyes/pngtree-sport-glasses-mockup-mock-up-picture-image_7736765-removebg-preview.png') center center / contain no-repeat;"></div>
          <div class="editor-grid-item eyes-grid-option" id="eyes-clipart-item" style="background: url('eyes/sunglasses-clipart-design-illustration-free-png-removebg-preview (1).png') center center / contain no-repeat;"></div>
          <div class="editor-grid-item eyes-grid-option" id="eyes-rbvajfl-item" style="background: url('eyes/rBVaJFl_9t-AYmVHAAEE3Xj8F_Q250-removebg-preview.png') center center / contain no-repeat;"></div>
        </div>
        <!-- Hats grid, hidden by default -->
        <div class="editor-grid-items" id="hats-grid-items" style="display:none;">
          <div class="editor-grid-item eyes-grid-option" id="hat-armyhelmet-item" style="background: url('hats/army-helmet.png') center center / contain no-repeat;"></div>
          <div class="editor-grid-item eyes-grid-option" id="hat-sidepart-item" style="background: url('hats/sideparthat.png') center center / contain no-repeat;"></div>
        </div>
        <!-- Extras grid, hidden by default -->
        <div class="editor-grid-items" id="extras-grid-items" style="display:none;">
          <div class="editor-grid-item eyes-grid-option" id="extras-chain-item" style="background: url('extras/goldchain.png') center center / contain no-repeat;"></div>
          <div class="editor-grid-item eyes-grid-option" id="extras-money-item" style="background: url('extras/stack-money-on-white-backround-260nw-71606644-removebg-preview.png') center center / contain no-repeat;"></div>
          <div class="editor-grid-item eyes-grid-option" id="extras-image-item" style="background: url('extras/images-removebg-preview.png') center center / contain no-repeat;"></div>
          <div class="editor-grid-item eyes-grid-option" id="extras-28de-item" style="background: url('extras/28de83405317503236d1625e11031acc-removebg-preview.png') center center / contain no-repeat;"></div>
          <div class="editor-grid-item eyes-grid-option" id="extras-screenshot-item" style="background: url('extras/Screenshot_2025-07-14_181558-removebg-preview.png') center center / contain no-repeat;"></div>
          <div class="editor-grid-item eyes-grid-option" id="extras-108-item" style="background: url('extras/108-1089650_mlg-quickscope-png-duty-modern-warfare-2-intervention-removebg-preview.png') center center / contain no-repeat;"></div>
          <div class="editor-grid-item eyes-grid-option" id="extras-smoke-item" style="background: url('extras/smoke.png') center center / contain no-repeat;"></div>
        </div>
      </div>
    </div>
  </div>

  <!-- Move script to here, just before </body> -->
  <script>
    function copyCA() {
      const ca = document.getElementById('ca').innerText;
      navigator.clipboard.writeText(ca);
    }
    // Tab switching logic
    document.querySelectorAll('.editor-tab').forEach(tab => {
      tab.addEventListener('click', function() {
        document.querySelectorAll('.editor-tab').forEach(t => t.classList.remove('active'));
        this.classList.add('active');
        const tabName = this.getAttribute('data-tab');
        document.getElementById('editor-grid-title').textContent = tabName.toUpperCase();
        // Show/hide grids
        if(tabName === 'Cat') {
          document.getElementById('cat-grid-items').style.display = 'flex';
          document.getElementById('editor-grid-items').style.display = 'none';
          document.getElementById('eyes-grid-items').style.display = 'none';
          document.getElementById('hats-grid-items').style.display = 'none';
          document.getElementById('extras-grid-items').style.display = 'none';
        } else if(tabName === 'Background') {
          document.getElementById('cat-grid-items').style.display = 'none';
          document.getElementById('editor-grid-items').style.display = '';
          document.getElementById('eyes-grid-items').style.display = 'none';
          document.getElementById('hats-grid-items').style.display = 'none';
          document.getElementById('extras-grid-items').style.display = 'none';
        } else if(tabName === 'Eyes') {
          document.getElementById('cat-grid-items').style.display = 'none';
          document.getElementById('editor-grid-items').style.display = 'none';
          document.getElementById('eyes-grid-items').style.display = '';
          document.getElementById('hats-grid-items').style.display = 'none';
          document.getElementById('extras-grid-items').style.display = 'none';
        } else if(tabName === 'Hats') {
          document.getElementById('cat-grid-items').style.display = 'none';
          document.getElementById('editor-grid-items').style.display = 'none';
          document.getElementById('eyes-grid-items').style.display = 'none';
          document.getElementById('hats-grid-items').style.display = '';
          document.getElementById('extras-grid-items').style.display = 'none';
        } else if(tabName === 'Extras') {
          document.getElementById('cat-grid-items').style.display = 'none';
          document.getElementById('editor-grid-items').style.display = 'none';
          document.getElementById('eyes-grid-items').style.display = 'none';
          document.getElementById('hats-grid-items').style.display = 'none';
          document.getElementById('extras-grid-items').style.display = '';
        } else {
          document.getElementById('cat-grid-items').style.display = 'none';
          document.getElementById('editor-grid-items').style.display = '';
          document.getElementById('eyes-grid-items').style.display = 'none';
          document.getElementById('hats-grid-items').style.display = 'none';
          document.getElementById('extras-grid-items').style.display = 'none';
        }
      });
    });
    // Cat selection handlers
    document.getElementById('cat-zazu-item').addEventListener('click', function() {
      document.getElementById('editor-zazu').src = 'zazu.png';
      // Reposition existing overlays for the new cat
      repositionOverlaysForCurrentCat();
    });
    
    document.getElementById('cat-rigby-item').addEventListener('click', function() {
      document.getElementById('editor-zazu').src = 'rigby.png';
      repositionOverlaysForCurrentCat();
    });

    document.getElementById('cat-cat3-item').addEventListener('click', function() {
      document.getElementById('editor-zazu').src = 'cat3.png';
      repositionOverlaysForCurrentCat();
    });

    document.getElementById('cat-cat4-item').addEventListener('click', function() {
      document.getElementById('editor-zazu').src = 'cat4.png';
      repositionOverlaysForCurrentCat();
    });

    document.getElementById('cat-cat5-item').addEventListener('click', function() {
      document.getElementById('editor-zazu').src = 'cat5.png';
      repositionOverlaysForCurrentCat();
    });

    document.getElementById('cat-crying-item').addEventListener('click', function() {
      document.getElementById('editor-zazu').src = 'crying.png';
      repositionOverlaysForCurrentCat();
    });
    
    // Eyes: 8 bit glasses click handler
    document.getElementById('eyes-8bit-item').addEventListener('click', function() {
      const eyesImg = document.getElementById('editor-eyes');
      const currentCat = document.getElementById('editor-zazu').src;
      eyesImg.src = 'eyes/8bit-glasses.png';
      eyesImg.style.display = eyesImg.src ? '' : 'none';
      eyesImg.removeAttribute('class');
      eyesImg.style.position = 'absolute';
      
      if (currentCat.includes('zazu.png')) {
        // Zazu positioning (smaller cat)
        eyesImg.style.width = '300px';
        eyesImg.style.height = '140px';
        eyesImg.style.left = '67px';
        eyesImg.style.top = '75px';
      } else {
        // Rigby positioning (larger cat)
        eyesImg.style.width = '260px';
        eyesImg.style.height = '130px';
        eyesImg.style.left = '60px';
        eyesImg.style.top = '100px';
      }
      
      eyesImg.style.zIndex = '10';
      eyesImg.style.filter = 'drop-shadow(0 2px 6px rgba(0,0,0,0.4))';
      enableOverlayDrag(eyesImg, 'EYES');
    });
    // Eyes: shutter shades click handler
    document.getElementById('eyes-shuttershades-item').addEventListener('click', function() {
      const eyesImg = document.getElementById('editor-eyes');
      const currentCat = document.getElementById('editor-zazu').src;
      eyesImg.src = 'eyes/png-transparent-white-eyewear-shutter-shades-aviator-sunglasses-shutter-s-text-monochrome-glasses-removebg-preview.png';
      eyesImg.style.display = eyesImg.src ? '' : 'none';
      eyesImg.removeAttribute('class');
      eyesImg.style.position = 'absolute';
      
      if (currentCat.includes('zazu.png')) {
        // Zazu positioning (smaller cat)
        eyesImg.style.width = '200px';
        eyesImg.style.height = '60px';
        eyesImg.style.left = '85px';
        eyesImg.style.top = '135px';
      } else {
        // Rigby positioning (larger cat)
        eyesImg.style.width = '150px';
        eyesImg.style.height = '40px';
        eyesImg.style.left = '90px';
        eyesImg.style.top = '160px';
      }
      
      eyesImg.style.zIndex = '10';
      eyesImg.style.filter = 'drop-shadow(0 2px 6px rgba(0,0,0,0.4))';
      enableOverlayDrag(eyesImg, 'EYES');
    });
    // Eyes: clout goggles click handler
    document.getElementById('eyes-cloutgoggles-item').addEventListener('click', function() {
      const eyesImg = document.getElementById('editor-eyes');
      const currentCat = document.getElementById('editor-zazu').src;
      eyesImg.src = 'eyes/7-79919_cartoon-clout-goggles-transparent-hd-png-download-removebg-preview.png';
      eyesImg.style.display = eyesImg.src ? '' : 'none';
      eyesImg.removeAttribute('class');
      eyesImg.style.position = 'absolute';
      
      if (currentCat.includes('zazu.png')) {
        // Zazu positioning (smaller cat)
        eyesImg.style.width = '200px';
        eyesImg.style.height = '60px';
        eyesImg.style.left = '85px';
        eyesImg.style.top = '125px';
      } else {
        // Rigby positioning (larger cat)
        eyesImg.style.width = '170px';
        eyesImg.style.height = '60px';
        eyesImg.style.left = '80px';
        eyesImg.style.top = '145px';
      }
      
      eyesImg.style.zIndex = '10';
      eyesImg.style.filter = 'drop-shadow(0 2px 6px rgba(0,0,0,0.4))';
      enableOverlayDrag(eyesImg, 'EYES');
    });
    // Eyes: vector glasses click handler
    document.getElementById('eyes-vector-item').addEventListener('click', function() {
      const eyesImg = document.getElementById('editor-eyes');
      const currentCat = document.getElementById('editor-zazu').src;
      eyesImg.src = 'eyes/pngtree-eye-glass-vector-png-image_4485520-removebg-preview.png';
      eyesImg.style.display = eyesImg.src ? '' : 'none';
      eyesImg.removeAttribute('class');
      eyesImg.style.position = 'absolute';
      
      if (currentCat.includes('zazu.png')) {
        // Zazu positioning (smaller cat)
        eyesImg.style.width = '200px';
        eyesImg.style.height = '200px';
        eyesImg.style.left = '80px';
        eyesImg.style.top = '70px';
      } else {
        // Rigby positioning (larger cat)
        eyesImg.style.width = '180px';
        eyesImg.style.height = '115px';
        eyesImg.style.left = '75px';
        eyesImg.style.top = '125px';
      }
      
      eyesImg.style.zIndex = '10';
      eyesImg.style.filter = 'drop-shadow(0 2px 6px rgba(0,0,0,0.4))';
      enableOverlayDrag(eyesImg, 'EYES');
    });
    // Eyes: sport glasses click handler
    document.getElementById('eyes-sport-item').addEventListener('click', function() {
      const eyesImg = document.getElementById('editor-eyes');
      const currentCat = document.getElementById('editor-zazu').src;
      eyesImg.src = 'eyes/pngtree-sport-glasses-mockup-mock-up-picture-image_7736765-removebg-preview.png';
      eyesImg.style.display = eyesImg.src ? '' : 'none';
      eyesImg.removeAttribute('class');
      eyesImg.style.position = 'absolute';
      
      if (currentCat.includes('zazu.png')) {
        // Zazu positioning (smaller cat)
        eyesImg.style.width = '254px';
        eyesImg.style.height = '174px';
        eyesImg.style.left = '60px';
        eyesImg.style.top = '79px';
      } else {
        // Rigby positioning (larger cat)
        eyesImg.style.width = '224px';
        eyesImg.style.height = '144px';
        eyesImg.style.left = '48px';
        eyesImg.style.top = '107px';
      }
      
      eyesImg.style.zIndex = '15';
      eyesImg.style.filter = 'drop-shadow(0 2px 6px rgba(0,0,0,0.4))';
      enableOverlayDrag(eyesImg, 'EYES');
    });
    // Eyes: clipart sunglasses click handler
    document.getElementById('eyes-clipart-item').addEventListener('click', function() {
      const eyesImg = document.getElementById('editor-eyes');
      const currentCat = document.getElementById('editor-zazu').src;
      eyesImg.src = "eyes/sunglasses-clipart-design-illustration-free-png-removebg-preview (1).png";
      eyesImg.style.display = eyesImg.src ? '' : 'none';
      eyesImg.removeAttribute('class');
      eyesImg.style.position = 'absolute';
      
      if (currentCat.includes('zazu.png')) {
        // Zazu positioning (smaller cat)
        eyesImg.style.width = '190px';
        eyesImg.style.height = '60px';
        eyesImg.style.left = '90px';
        eyesImg.style.top = '133px';
      } else {
        // Rigby positioning (larger cat)
        eyesImg.style.width = '160px';
        eyesImg.style.height = '50px';
        eyesImg.style.left = '85px';
        eyesImg.style.top = '155px';
      }
      
      eyesImg.style.zIndex = '10';
      eyesImg.style.filter = 'drop-shadow(0 2px 6px rgba(0,0,0,0.4))';
      enableOverlayDrag(eyesImg, 'EYES');
    });
    // Eyes: rbvajfl sunglasses click handler
    document.getElementById('eyes-rbvajfl-item').addEventListener('click', function() {
      const eyesImg = document.getElementById('editor-eyes');
      eyesImg.src = 'eyes/rBVaJFl_9t-AYmVHAAEE3Xj8F_Q250-removebg-preview.png';
      eyesImg.style.display = eyesImg.src ? '' : 'none';
      eyesImg.removeAttribute('class');
      eyesImg.style.position = 'absolute';
      eyesImg.style.width = '280px';
      eyesImg.style.height = '120px';
      eyesImg.style.left = '50px';
      eyesImg.style.top = '95px';
      eyesImg.style.zIndex = '10';
      eyesImg.style.filter = 'drop-shadow(0 2px 6px rgba(0,0,0,0.4))';
      enableOverlayDrag(eyesImg, 'EYES');
    });
    // Add click handler for first background (white)
    document.getElementById('bg-white-item').addEventListener('click', function() {
      const zazuFrame = document.getElementById('zazu-frame');
      zazuFrame.classList.add('bg-white');
      zazuFrame.classList.remove('bg-csgo','bg-1000yard','bg-us15','bg-7mjhif','bg-bg1','bg-bg2');
    });
    document.getElementById('bg-csgo-item').addEventListener('click', function() {
      const zazuFrame = document.getElementById('zazu-frame');
      zazuFrame.classList.add('bg-csgo');
      zazuFrame.classList.remove('bg-white','bg-1000yard','bg-us15','bg-7mjhif','bg-bg1','bg-bg2');
    });
    document.getElementById('bg-1000yard-item').addEventListener('click', function() {
      const zazuFrame = document.getElementById('zazu-frame');
      zazuFrame.classList.add('bg-1000yard');
      zazuFrame.classList.remove('bg-white','bg-csgo','bg-us15','bg-7mjhif','bg-bg1','bg-bg2');
    });
    document.getElementById('bg-us15-item').addEventListener('click', function() {
      const zazuFrame = document.getElementById('zazu-frame');
      zazuFrame.classList.add('bg-us15');
      zazuFrame.classList.remove('bg-white','bg-csgo','bg-1000yard','bg-7mjhif','bg-bg1','bg-bg2');
    });
    document.getElementById('bg-7mjhif-item').addEventListener('click', function() {
      const zazuFrame = document.getElementById('zazu-frame');
      zazuFrame.classList.add('bg-7mjhif');
      zazuFrame.classList.remove('bg-white','bg-csgo','bg-1000yard','bg-us15','bg-bg1','bg-bg2');
    });
    document.getElementById('bg-bg1-item').addEventListener('click', function() {
      const zazuFrame = document.getElementById('zazu-frame');
      zazuFrame.classList.add('bg-bg1');
      zazuFrame.classList.remove('bg-white','bg-csgo','bg-1000yard','bg-us15','bg-7mjhif','bg-bg2');
    });
    document.getElementById('bg-bg2-item').addEventListener('click', function() {
      const zazuFrame = document.getElementById('zazu-frame');
      zazuFrame.classList.add('bg-bg2');
      zazuFrame.classList.remove('bg-white','bg-csgo','bg-1000yard','bg-us15','bg-7mjhif','bg-bg1');
    });
    // Hats: army helmet click handler
    document.getElementById('hat-armyhelmet-item').addEventListener('click', function() {
      const hatImg = document.getElementById('editor-hat');
      const currentCat = document.getElementById('editor-zazu').src;
      hatImg.src = 'hats/army-helmet.png';
      hatImg.style.display = '';
      hatImg.style.position = 'absolute';

      if (currentCat.includes('zazu.png')) {
        hatImg.style.width = '350px';
        hatImg.style.height = '150px';
        hatImg.style.left = '5px';
        hatImg.style.top = '75px';
      } else {
        hatImg.style.width = '330px';
        hatImg.style.height = '160px';
        hatImg.style.left = '5px';
        hatImg.style.top = '95px';
      }

      hatImg.style.zIndex = '20';
      hatImg.style.filter = 'drop-shadow(0 2px 6px rgba(0,0,0,0.4))';
      enableOverlayDrag(hatImg, 'HAT');
    });

    // Hats: side part hat click handler
    document.getElementById('hat-sidepart-item').addEventListener('click', function() {
      const hatImg = document.getElementById('editor-hat');
      const currentCat = document.getElementById('editor-zazu').src;
      hatImg.src = 'hats/sideparthat.png';
      hatImg.style.display = '';
      hatImg.style.position = 'absolute';

      if (currentCat.includes('zazu.png')) {
        hatImg.style.width = '220px';
        hatImg.style.height = '120px';
        hatImg.style.left = '75px';
        hatImg.style.top = '50px';
      } else {
        hatImg.style.width = '220px';
        hatImg.style.height = '120px';
        hatImg.style.left = '70px';
        hatImg.style.top = '70px';
      }

      hatImg.style.zIndex = '20';
      hatImg.style.filter = 'drop-shadow(0 2px 6px rgba(0,0,0,0.4))';
      enableOverlayDrag(hatImg, 'HAT');
    });

    // ── Generic overlay drag & resize logic (hat + eyes) ──
    let activeOverlayEl = null;
    let overlayDragging = false;
    let overlayDragOffsetX = 0;
    let overlayDragOffsetY = 0;

    function enableOverlayDrag(el, label) {
      if (activeOverlayEl && activeOverlayEl !== el) confirmOverlay();
      activeOverlayEl = el;
      el.classList.remove('overlay-locked', 'overlay-dragging');
      el.classList.add('overlay-draggable');
      el.style.pointerEvents = 'auto';
      el.dataset.baseWidth  = parseFloat(el.style.width)  || el.offsetWidth;
      el.dataset.baseHeight = parseFloat(el.style.height) || el.offsetHeight;
      document.getElementById('overlay-flip-controls').classList.add('visible');
      document.getElementById('confirm-overlay-btn').classList.add('visible');
      handleContainer.style.display = 'block';
      updateHandles();
    }

    function confirmOverlay() {
      if (!activeOverlayEl) return;
      activeOverlayEl.classList.remove('overlay-draggable', 'overlay-dragging');
      activeOverlayEl.classList.add('overlay-locked');
      activeOverlayEl.style.pointerEvents = 'none';
      activeOverlayEl = null;
      overlayDragging = false;
      document.getElementById('overlay-flip-controls').classList.remove('visible');
      document.getElementById('confirm-overlay-btn').classList.remove('visible');
      document.getElementById('overlay-handle-container').style.display = 'none';
    }

    // ── Photoshop-style handles (rotate + scale) ──
    const handleContainer = document.getElementById('overlay-handle-container');
    const ohRot = document.getElementById('oh-rot');
    const ohTL  = document.getElementById('oh-tl');
    const ohTR  = document.getElementById('oh-tr');
    const ohBL  = document.getElementById('oh-bl');
    const ohBR  = document.getElementById('oh-br');
    let handleDragging = null;
    let handleDragStart = null;

    function updateHandles() {
      if (!activeOverlayEl || handleContainer.style.display === 'none') return;
      const frame = document.getElementById('zazu-frame');
      const fr    = frame.getBoundingClientRect();
      const er    = activeOverlayEl.getBoundingClientRect();
      const L = er.left - fr.left, T = er.top - fr.top, W = er.width, H = er.height;
      ohRot.style.left = (L + W / 2 - 8) + 'px';
      ohRot.style.top  = Math.max(2, T - 30) + 'px';
      ohTL.style.left  = (L - 6) + 'px';      ohTL.style.top = (T - 6) + 'px';
      ohTR.style.left  = (L + W - 6) + 'px';  ohTR.style.top = (T - 6) + 'px';
      ohBL.style.left  = (L - 6) + 'px';      ohBL.style.top = (T + H - 6) + 'px';
      ohBR.style.left  = (L + W - 6) + 'px';  ohBR.style.top = (T + H - 6) + 'px';
    }

    [{el: ohRot, key:'rot'}, {el: ohTL, key:'tl'}, {el: ohTR, key:'tr'}, {el: ohBL, key:'bl'}, {el: ohBR, key:'br'}].forEach(function(item) {
      item.el.addEventListener('mousedown', function(e) {
        if (!activeOverlayEl) return;
        e.preventDefault(); e.stopPropagation();
        handleDragging = item.key;
        const frame = document.getElementById('zazu-frame');
        const fr    = frame.getBoundingClientRect();
        const L = parseFloat(activeOverlayEl.style.left) || 0;
        const T = parseFloat(activeOverlayEl.style.top)  || 0;
        const W = parseFloat(activeOverlayEl.style.width)  || activeOverlayEl.offsetWidth;
        const H = parseFloat(activeOverlayEl.style.height) || activeOverlayEl.offsetHeight;
        const cx = fr.left + L + W / 2, cy = fr.top + T + H / 2;
        handleDragStart = {
          cx: cx, cy: cy, frLeft: fr.left, frTop: fr.top,
          initW: W, initH: H,
          initDist:  Math.max(1, Math.hypot(e.clientX - cx, e.clientY - cy)),
          initDeg:   parseFloat(activeOverlayEl.dataset.rotDeg || 0),
          initAngle: Math.atan2(e.clientY - cy, e.clientX - cx) * 180 / Math.PI,
        };
      });
    });

    document.addEventListener('mousemove', function(e) {
      if (!handleDragging || !activeOverlayEl || !handleDragStart) return;
      if (handleDragging === 'rot') {
        const angle = Math.atan2(e.clientY - handleDragStart.cy, e.clientX - handleDragStart.cx) * 180 / Math.PI;
        activeOverlayEl.dataset.rotDeg = Math.round(handleDragStart.initDeg + (angle - handleDragStart.initAngle));
        applyOverlayTransform();
      } else {
        const dist  = Math.hypot(e.clientX - handleDragStart.cx, e.clientY - handleDragStart.cy);
        const scale = dist / handleDragStart.initDist;
        const newW  = Math.max(20, handleDragStart.initW * scale);
        const newH  = Math.max(20, handleDragStart.initH * scale);
        activeOverlayEl.style.width  = newW + 'px';
        activeOverlayEl.style.height = newH + 'px';
        activeOverlayEl.style.left   = (handleDragStart.cx - handleDragStart.frLeft - newW / 2) + 'px';
        activeOverlayEl.style.top    = (handleDragStart.cy - handleDragStart.frTop  - newH / 2) + 'px';
        activeOverlayEl.dataset.baseWidth  = newW;
        activeOverlayEl.dataset.baseHeight = newH;
      }
      updateHandles();
    }, true);

    document.addEventListener('mouseup', function() {
      if (handleDragging) { handleDragging = null; handleDragStart = null; }
    }, true);

    function applyOverlayTransform() {
      if (!activeOverlayEl) return;
      const deg   = parseFloat(activeOverlayEl.dataset.rotDeg || 0);
      const flipH = activeOverlayEl.dataset.flipH === '1' ? -1 : 1;
      const flipV = activeOverlayEl.dataset.flipV === '1' ? -1 : 1;
      activeOverlayEl.style.transform = 'rotate(' + deg + 'deg) scale(' + flipH + ',' + flipV + ')';
    }

    function flipOverlayH() {
      if (!activeOverlayEl) return;
      activeOverlayEl.dataset.flipH = activeOverlayEl.dataset.flipH === '1' ? '0' : '1';
      applyOverlayTransform();
    }

    function flipOverlayV() {
      if (!activeOverlayEl) return;
      activeOverlayEl.dataset.flipV = activeOverlayEl.dataset.flipV === '1' ? '0' : '1';
      applyOverlayTransform();
    }

    // Drag — mouse & touch for both hat and eyes
    ['editor-hat', 'editor-eyes', 'editor-extras'].forEach(function(id) {
      document.getElementById(id).addEventListener('mousedown', function(e) {
        if (!this.classList.contains('overlay-draggable')) return;
        e.preventDefault();
        overlayDragging = true;
        activeOverlayEl = this;
        this.classList.add('overlay-dragging');
        overlayDragOffsetX = e.clientX - parseInt(this.style.left || 0);
        overlayDragOffsetY = e.clientY - parseInt(this.style.top  || 0);
      });
      document.getElementById(id).addEventListener('touchstart', function(e) {
        if (!this.classList.contains('overlay-draggable')) return;
        e.preventDefault();
        overlayDragging = true;
        activeOverlayEl = this;
        const t = e.touches[0];
        overlayDragOffsetX = t.clientX - parseInt(this.style.left || 0);
        overlayDragOffsetY = t.clientY - parseInt(this.style.top  || 0);
      }, { passive: false });
    });

    document.addEventListener('mousemove', function(e) {
      if (!overlayDragging || !activeOverlayEl) return;
      const frame = document.getElementById('zazu-frame');
      const elW = activeOverlayEl.offsetWidth;
      const elH = activeOverlayEl.offsetHeight;
      let newLeft = e.clientX - overlayDragOffsetX;
      let newTop  = e.clientY - overlayDragOffsetY;
      newLeft = Math.max(-elW / 2, Math.min(frame.offsetWidth  - elW / 2, newLeft));
      newTop  = Math.max(-elH / 2, Math.min(frame.offsetHeight - elH / 2, newTop));
      activeOverlayEl.style.left = newLeft + 'px';
      activeOverlayEl.style.top  = newTop  + 'px';
      updateHandles();
    });

    document.addEventListener('mouseup', function() {
      if (!overlayDragging) return;
      overlayDragging = false;
      if (activeOverlayEl) activeOverlayEl.classList.remove('overlay-dragging');
    });

    document.addEventListener('touchmove', function(e) {
      if (!overlayDragging || !activeOverlayEl) return;
      e.preventDefault();
      const frame = document.getElementById('zazu-frame');
      const elW = activeOverlayEl.offsetWidth;
      const elH = activeOverlayEl.offsetHeight;
      const t = e.touches[0];
      let newLeft = t.clientX - overlayDragOffsetX;
      let newTop  = t.clientY - overlayDragOffsetY;
      newLeft = Math.max(-elW / 2, Math.min(frame.offsetWidth  - elW / 2, newLeft));
      newTop  = Math.max(-elH / 2, Math.min(frame.offsetHeight - elH / 2, newTop));
      activeOverlayEl.style.left = newLeft + 'px';
      activeOverlayEl.style.top  = newTop  + 'px';
    }, { passive: false });

    document.addEventListener('touchend', function() {
      overlayDragging = false;
    });
    // Extras: thug life chain
    document.getElementById('extras-chain-item').addEventListener('click', function() {
      const extrasImg = document.getElementById('editor-extras');
      extrasImg.src = 'extras/goldchain.png';
      extrasImg.style.display = extrasImg.src ? '' : 'none';
      extrasImg.style.position = 'absolute';
      extrasImg.style.width = '180px';
      extrasImg.style.height = '50px';
      extrasImg.style.left = '85px';
      extrasImg.style.top = '280px';
      extrasImg.style.zIndex = '50';
      extrasImg.style.filter = 'drop-shadow(0 2px 6px rgba(0,0,0,0.4))';
      enableOverlayDrag(extrasImg, 'EXTRAS');
    });
    // Extras: stack of money
    document.getElementById('extras-money-item').addEventListener('click', function() {
      const extrasImg = document.getElementById('editor-extras');
      extrasImg.src = 'extras/stack-money-on-white-backround-260nw-71606644-removebg-preview.png';
      extrasImg.style.display = extrasImg.src ? '' : 'none';
      extrasImg.style.position = 'absolute';
      extrasImg.style.width = '220px';
      extrasImg.style.height = '80px';
      extrasImg.style.left = '100px';
      extrasImg.style.top = '260px';
      extrasImg.style.zIndex = '50';
      extrasImg.style.filter = 'drop-shadow(0 2px 6px rgba(0,0,0,0.4))';
      enableOverlayDrag(extrasImg, 'EXTRAS');
    });
    // Extras: images-removebg-preview
    document.getElementById('extras-image-item').addEventListener('click', function() {
      const extrasImg = document.getElementById('editor-extras');
      extrasImg.src = 'extras/images-removebg-preview.png';
      extrasImg.style.display = extrasImg.src ? '' : 'none';
      extrasImg.style.position = 'absolute';
      extrasImg.style.width = '120px';
      extrasImg.style.height = '80px';
      extrasImg.style.left = '107px';
      extrasImg.style.top = '280px';
      extrasImg.style.zIndex = '50';
      extrasImg.style.filter = 'drop-shadow(0 2px 6px rgba(0,0,0,0.4))';
      enableOverlayDrag(extrasImg, 'EXTRAS');
    });
    // Extras: 28de8340... item
    document.getElementById('extras-28de-item').addEventListener('click', function() {
      const extrasImg = document.getElementById('editor-extras');
      extrasImg.src = 'extras/28de83405317503236d1625e11031acc-removebg-preview.png';
      extrasImg.style.display = extrasImg.src ? '' : 'none';
      extrasImg.style.position = 'absolute';
      extrasImg.style.width = '120px';
      extrasImg.style.height = '90px';
      extrasImg.style.left = '165px';
      extrasImg.style.top = '242px';
      extrasImg.style.zIndex = '50';
      extrasImg.style.filter = 'drop-shadow(0 2px 6px rgba(0,0,0,0.4))';
      enableOverlayDrag(extrasImg, 'EXTRAS');
    });
    // Extras: screenshot item
    document.getElementById('extras-screenshot-item').addEventListener('click', function() {
      const extrasImg = document.getElementById('editor-extras');
      extrasImg.src = 'extras/Screenshot_2025-07-14_181558-removebg-preview.png';
      extrasImg.style.display = extrasImg.src ? '' : 'none';
      extrasImg.style.position = 'absolute';
      extrasImg.style.width = '120px';
      extrasImg.style.height = '120px';
      extrasImg.style.left = '115px';
      extrasImg.style.top = '190px';
      extrasImg.style.zIndex = '50';
      extrasImg.style.filter = 'drop-shadow(0 2px 6px rgba(0,0,0,0.4))';
      enableOverlayDrag(extrasImg, 'EXTRAS');
    });
    // Extras: 108 quickscope
    document.getElementById('extras-108-item').addEventListener('click', function() {
      const extrasImg = document.getElementById('editor-extras');
      extrasImg.src = 'extras/108-1089650_mlg-quickscope-png-duty-modern-warfare-2-intervention-removebg-preview.png';
      extrasImg.style.display = extrasImg.src ? '' : 'none';
      extrasImg.style.position = 'absolute';
      extrasImg.style.width = '320px';
      extrasImg.style.height = '120px';
      extrasImg.style.left = '55px';
      extrasImg.style.top = '243px';
      extrasImg.style.zIndex = '50';
      extrasImg.style.filter = 'drop-shadow(0 2px 6px rgba(0,0,0,0.4))';
      enableOverlayDrag(extrasImg, 'EXTRAS');
    });
    // Extras: smoke
    document.getElementById('extras-smoke-item').addEventListener('click', function() {
      const extrasImg = document.getElementById('editor-extras');
      extrasImg.src = 'extras/smoke.png';
      extrasImg.style.display = extrasImg.src ? '' : 'none';
      extrasImg.style.position = 'absolute';
      extrasImg.style.width = '120px';
      extrasImg.style.height = '90px';
      extrasImg.style.left = '165px';
      extrasImg.style.top = '245px';
      extrasImg.style.zIndex = '50';
      extrasImg.style.filter = 'drop-shadow(0 2px 6px rgba(0,0,0,0.4))';
      enableOverlayDrag(extrasImg, 'EXTRAS');
    });
    // Function to reposition existing overlays when switching cats
    function repositionOverlaysForCurrentCat() {
      const currentCat = document.getElementById('editor-zazu').src;
      const eyesImg = document.getElementById('editor-eyes');
      const hatImg = document.getElementById('editor-hat');
      
      // Reposition eyes if they're visible
      if (eyesImg && eyesImg.style.display !== 'none' && eyesImg.src) {
        if (eyesImg.src.includes('8bit-glasses.png')) {
          if (currentCat.includes('zazu.png')) {
            eyesImg.style.width = '300px';
            eyesImg.style.height = '140px';
            eyesImg.style.left = '67px';
            eyesImg.style.top = '75px';
          } else {
            eyesImg.style.width = '260px';
            eyesImg.style.height = '130px';
            eyesImg.style.left = '60px';
            eyesImg.style.top = '100px';
          }
        } else if (eyesImg.src.includes('shutter-shades')) {
          if (currentCat.includes('zazu.png')) {
            eyesImg.style.width = '200px';
            eyesImg.style.height = '60px';
            eyesImg.style.left = '85px';
            eyesImg.style.top = '135px';
          } else {
            eyesImg.style.width = '150px';
            eyesImg.style.height = '40px';
            eyesImg.style.left = '90px';
            eyesImg.style.top = '160px';
          }
        } else if (eyesImg.src.includes('clout-goggles')) {
          if (currentCat.includes('zazu.png')) {
            eyesImg.style.width = '200px';
            eyesImg.style.height = '60px';
            eyesImg.style.left = '85px';
            eyesImg.style.top = '125px';
          } else {
            eyesImg.style.width = '170px';
            eyesImg.style.height = '60px';
            eyesImg.style.left = '80px';
            eyesImg.style.top = '145px';
          }
        } else if (eyesImg.src.includes('vector')) {
          if (currentCat.includes('zazu.png')) {
            eyesImg.style.width = '200px';
            eyesImg.style.height = '200px';
            eyesImg.style.left = '80px';
            eyesImg.style.top = '70px';
          } else {
            eyesImg.style.width = '180px';
            eyesImg.style.height = '115px';
            eyesImg.style.left = '75px';
            eyesImg.style.top = '125px';
          }
        } else if (eyesImg.src.includes('sport')) {
          if (currentCat.includes('zazu.png')) {
            eyesImg.style.width = '254px';
            eyesImg.style.height = '174px';
            eyesImg.style.left = '60px';
            eyesImg.style.top = '79px';
          } else {
            eyesImg.style.width = '224px';
            eyesImg.style.height = '144px';
            eyesImg.style.left = '48px';
            eyesImg.style.top = '107px';
          }
        } else if (eyesImg.src.includes('clipart')) {
          if (currentCat.includes('zazu.png')) {
            eyesImg.style.width = '190px';
            eyesImg.style.height = '60px';
            eyesImg.style.left = '90px';
            eyesImg.style.top = '133px';
          } else {
            eyesImg.style.width = '160px';
            eyesImg.style.height = '50px';
            eyesImg.style.left = '85px';
            eyesImg.style.top = '155px';
          }
        } else if (eyesImg.src.includes('rbvajfl')) {
          // rbvajfl doesn't have conditional positioning yet, keep current
          eyesImg.style.width = '280px';
          eyesImg.style.height = '120px';
          eyesImg.style.left = '50px';
          eyesImg.style.top = '95px';
        }
      }
      
      // Reposition hat if it's visible
      if (hatImg && hatImg.style.display !== 'none' && hatImg.src) {
        if (hatImg.src.includes('army-helmet')) {
          if (currentCat.includes('zazu.png')) {
            hatImg.style.width = '350px';
            hatImg.style.height = '150px';
            hatImg.style.left = '5px';
            hatImg.style.top = '75px';
          } else {
            hatImg.style.width = '330px';
            hatImg.style.height = '160px';
            hatImg.style.left = '05px';
            hatImg.style.top = '95px';
          }
        } else if (hatImg.src.includes('beanie')) {
          if (currentCat.includes('zazu.png')) {
            hatImg.style.width = '208px';
            hatImg.style.height = '60px';
            hatImg.style.left = '95px';
            hatImg.style.top = '80px';
          } else {
            hatImg.style.width = '208px';
            hatImg.style.height = '80px';
            hatImg.style.left = '75px';
            hatImg.style.top = '115px';
          }
        } else if (hatImg.src.includes('cowboy-hat')) {
          if (currentCat.includes('zazu.png')) {
            hatImg.style.width = '400px';
            hatImg.style.height = '150px';
            hatImg.style.left = '-10px';
            hatImg.style.top = '35px';
          } else {
            hatImg.style.width = '390px';
            hatImg.style.height = '150px';
            hatImg.style.left = '-33px';
            hatImg.style.top = '75px';
          }
        } else if (hatImg.src.includes('viking')) {
          if (currentCat.includes('zazu.png')) {
            hatImg.style.width = '300px';
            hatImg.style.height = '145px';
            hatImg.style.left = '35px';
            hatImg.style.top = '15px';
          } else {
            hatImg.style.width = '300px';
            hatImg.style.height = '195px';
            hatImg.style.left = '15px';
            hatImg.style.top = '20px';
          }
        } else if (hatImg.src.includes('maga-hat')) {
          if (currentCat.includes('zazu.png')) {
            hatImg.style.width = '220px';
            hatImg.style.height = '140px';
            hatImg.style.left = '75px';
            hatImg.style.top = '25px';
          } else {
            hatImg.style.width = '190px';
            hatImg.style.height = '100px';
            hatImg.style.left = '65px';
            hatImg.style.top = '75px';
          }
        } else if (hatImg.src.includes('yankees-hat')) {
          if (currentCat.includes('zazu.png')) {
            hatImg.style.width = '180px';
            hatImg.style.height = '100px';
            hatImg.style.left = '95px';
            hatImg.style.top = '30px';
          } else {
            hatImg.style.width = '300px';
            hatImg.style.height = '100px';
            hatImg.style.left = '18px';
            hatImg.style.top = '80px';
          }
        } else if (hatImg.src.includes('random-hat')) {
          if (currentCat.includes('zazu.png')) {
            hatImg.style.width = '400px';
            hatImg.style.height = '150px';
            hatImg.style.left = '-5px';
            hatImg.style.top = '20px';
          } else {
            hatImg.style.width = '400px';
            hatImg.style.height = '150px';
            hatImg.style.left = '-30px';
            hatImg.style.top = '45px';
          }
        }
      }
    }

    function resetZazu() {
      // keep the current cat — don't change editor-zazu.src
      const zazuFrame = document.getElementById('zazu-frame');
      zazuFrame.classList.remove('bg-white','bg-csgo','bg-1000yard','bg-us15','bg-7mjhif','bg-bg1','bg-bg2');
      const eyesImg = document.getElementById('editor-eyes');
      eyesImg.src = '';
      eyesImg.style.display = 'none';
      eyesImg.alt = '';
      eyesImg.className = '';
      const hatImg = document.getElementById('editor-hat');
      hatImg.src = '';
      hatImg.style.display = 'none';
      hatImg.alt = '';
      hatImg.className = '';
      if (activeOverlayEl) { activeOverlayEl.classList.remove('overlay-draggable','overlay-dragging','overlay-locked'); activeOverlayEl = null; }
      overlayDragging = false;
      handleDragging = null;
      handleDragStart = null;
      document.getElementById('overlay-flip-controls').classList.remove('visible');
      document.getElementById('confirm-overlay-btn').classList.remove('visible');
      document.getElementById('overlay-handle-container').style.display = 'none';
      const extrasImg = document.getElementById('editor-extras');
      extrasImg.src = '';
      extrasImg.style.display = 'none';
      extrasImg.alt = '';
      extrasImg.className = '';
      // Fix grid layout bug on reset
      const catGrid = document.getElementById('cat-grid-items');
      const bgGrid = document.getElementById('editor-grid-items');
      catGrid.style.display = 'none';
      bgGrid.style.display = 'none';
      // Switch UI back to Cat tab
      document.querySelectorAll('.editor-tab').forEach(t => t.classList.remove('active'));
      document.querySelector('.editor-tab[data-tab="Cat"]').classList.add('active');
      document.getElementById('editor-grid-title').textContent = 'CAT';
      document.getElementById('editor-grid-items').style.display = 'none';
      document.getElementById('eyes-grid-items').style.display = 'none';
      document.getElementById('hats-grid-items').style.display = 'none';
      document.getElementById('extras-grid-items').style.display = 'none';
      setTimeout(() => {
        catGrid.style.display = 'flex';
        catGrid.scrollTop = 0;
      }, 0);
    }
    function downloadZazu() {
      const frame = document.getElementById('zazu-frame');
      const canvas = document.createElement('canvas');
      const size = 350;
      canvas.width = size;
      canvas.height = size;
      const ctx = canvas.getContext('2d');

      // Helper to draw an image if src is set (use already-loaded img element to avoid CORS/reload issues)
      function drawImageIfSet(img, dx=0, dy=0, dw=size, dh=size) {
        return new Promise(resolve => {
          if (!img || !img.src || img.src === window.location.href || img.src === '') return resolve();
          try {
            if (img.complete && img.naturalWidth > 0) {
              ctx.drawImage(img, dx, dy, dw, dh);
              return resolve();
            }
            const image = new window.Image();
            image.crossOrigin = 'anonymous';
            image.onload = function() {
              ctx.drawImage(image, dx, dy, dw, dh);
              resolve();
            };
            image.onerror = resolve;
            image.src = img.src;
          } catch (e) {
            resolve();
          }
        });
      }

      // Helper to get overlay rect relative to frame, scaled to canvas
      function getOverlayRect(img, frame) {
        if (!img || img.style.display === 'none') return null;
        const imgRect = img.getBoundingClientRect();
        const frameRect = frame.getBoundingClientRect();
        // Use the inner frame dimensions (350x350) for scaling, not the outer wrapper
        const scaleX = size / 350;
        const scaleY = size / 350;
        return {
          x: (imgRect.left - frameRect.left) * scaleX,
          y: (imgRect.top - frameRect.top) * scaleY,
          w: imgRect.width * scaleX,
          h: imgRect.height * scaleY
        };
      }

      // 1. Draw background (solid or image)
      let bgPromise = Promise.resolve();
      const bgClass = frame.className;
      if (bgClass.includes('bg-white')) {
        ctx.fillStyle = '#fff';
        ctx.fillRect(0, 0, size, size);
      } else {
        // Check for a background image class
        const bgMap = {
          'bg-csgo': 'backgrounds/csgo-dust-2-map-portion.avif',
          'bg-1000yard': 'backgrounds/i-give-up-can-someone-make-this-have-the-1000-yard-stare-v0-0xk9rgdol35e1.png',
          'bg-us15': 'backgrounds/US-15.jpg',
          'bg-7mjhif': 'backgrounds/7mjhif166f641.jpg',
          'bg-bg1': 'backgrounds/bg1.jpg',
        'bg-bg2': 'backgrounds/bg2.png',
        };
        let found = false;
        for (const key in bgMap) {
          if (bgClass.includes(key)) {
            found = true;
            const bgImg = new window.Image();
            bgImg.crossOrigin = 'anonymous';
            bgPromise = new Promise(resolve => {
              bgImg.onload = function() {
                ctx.drawImage(bgImg, 0, 0, size, size);
                resolve();
              };
              bgImg.onerror = resolve;
              bgImg.src = bgMap[key];
            });
            break;
          }
        }
        if (!found) {
          // Default to white if no background
          ctx.fillStyle = '#fff';
          ctx.fillRect(0, 0, size, size);
        }
      }

      // 2. Draw overlays in order: zazu, hat, eyes, extras
      const zazuImg = document.getElementById('editor-zazu');
      const hatImg = document.getElementById('editor-hat');
      const eyesImg = document.getElementById('editor-eyes');
      const extrasImg = document.getElementById('editor-extras');

      bgPromise.then(() => {
        // Draw Zazu using overlay positioning
        if (zazuImg && zazuImg.src) {
          const rect = getOverlayRect(zazuImg, frame);
          if (rect) {
            return drawImageIfSet(zazuImg, rect.x, rect.y, rect.w, rect.h);
          }
        }
        return Promise.resolve();
      }).then(() => {
        // Draw hat overlay (if visible)
        if (hatImg && hatImg.style.display !== 'none' && hatImg.src) {
          const rect = getOverlayRect(hatImg, frame);
          if (rect) {
            return drawImageIfSet(hatImg, rect.x, rect.y, rect.w, rect.h);
          }
        }
        return Promise.resolve();
      }).then(() => {
        // Draw eyes overlay (if visible)
        if (eyesImg && eyesImg.style.display !== 'none' && eyesImg.src) {
          const rect = getOverlayRect(eyesImg, frame);
          if (rect) {
            return drawImageIfSet(eyesImg, rect.x, rect.y, rect.w, rect.h);
          }
        }
        return Promise.resolve();
      }).then(() => {
        // Draw extras overlay (if visible)
        if (extrasImg && extrasImg.style.display !== 'none' && extrasImg.src) {
          const rect = getOverlayRect(extrasImg, frame);
          if (rect) {
            return drawImageIfSet(extrasImg, rect.x, rect.y, rect.w, rect.h);
          }
        }
        return Promise.resolve();
      }).then(() => {
        // Add a small delay to ensure all images are fully rendered
        return new Promise(resolve => setTimeout(resolve, 100));
      }).then(() => {
        let dataUrl;
        try {
          dataUrl = canvas.toDataURL('image/png');
        } catch (e) {
          alert('Download failed: canvas could not be exported (CORS issue). Try serving the page from a web server instead of opening it as a local file.');
          return;
        }
        const a = document.createElement('a');
        a.href = dataUrl;
        a.download = 'catcult-creation.png';
        a.style.display = 'none';
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
      }).catch(function(err) {
        alert('Download failed: ' + err.message);
      });
    }
  </script>
  <script>
    // Fix grid layout bug on initial page load
    window.addEventListener('DOMContentLoaded', function() {
      const catGrid = document.getElementById('cat-grid-items');
      const bgGrid = document.getElementById('editor-grid-items');
      catGrid.style.display = 'none';
      bgGrid.style.display = 'none';
      setTimeout(() => {
        catGrid.style.display = 'flex';
        catGrid.scrollTop = 0;
      }, 0);
    });
  </script>
  <script>
    // ── Shared canvas composition helper ──
    // Draws the current editor state onto the given canvas element.
    // Returns a Promise that resolves when drawing is complete.
    function buildEditorCanvas(canvas) {
      const frame = document.getElementById('zazu-frame');
      const size = 350;
      canvas.width = size;
      canvas.height = size;
      const ctx = canvas.getContext('2d');

      function drawImageIfSet(img, dx, dy, dw, dh) {
        return new Promise(resolve => {
          if (!img || !img.src || img.src === window.location.href || img.src === '') return resolve();
          try {
            if (img.complete && img.naturalWidth > 0) {
              ctx.drawImage(img, dx, dy, dw, dh);
              return resolve();
            }
            const image = new window.Image();
            image.onload = function() { ctx.drawImage(image, dx, dy, dw, dh); resolve(); };
            image.onerror = resolve;
            image.src = img.src;
          } catch (e) { resolve(); }
        });
      }

      function getOverlayRect(img) {
        if (!img || img.style.display === 'none') return null;
        const imgRect = img.getBoundingClientRect();
        const frameRect = frame.getBoundingClientRect();
        const scaleX = size / 350;
        const scaleY = size / 350;
        return {
          x: (imgRect.left - frameRect.left) * scaleX,
          y: (imgRect.top - frameRect.top) * scaleY,
          w: imgRect.width * scaleX,
          h: imgRect.height * scaleY
        };
      }

      const bgClass = frame.className;
      let bgPromise = Promise.resolve();
      if (bgClass.includes('bg-white')) {
        ctx.fillStyle = '#fff';
        ctx.fillRect(0, 0, size, size);
      } else {
        const bgMap = {
          'bg-csgo': 'backgrounds/csgo-dust-2-map-portion.avif',
          'bg-1000yard': 'backgrounds/i-give-up-can-someone-make-this-have-the-1000-yard-stare-v0-0xk9rgdol35e1.png',
          'bg-us15': 'backgrounds/US-15.jpg',
          'bg-7mjhif': 'backgrounds/7mjhif166f641.jpg',
          'bg-bg1': 'backgrounds/bg1.jpg',
        'bg-bg2': 'backgrounds/bg2.png',
        };
        let found = false;
        for (const key in bgMap) {
          if (bgClass.includes(key)) {
            found = true;
            const bgImg = new window.Image();
            bgPromise = new Promise(resolve => {
              bgImg.onload = function() { ctx.drawImage(bgImg, 0, 0, size, size); resolve(); };
              bgImg.onerror = resolve;
              bgImg.src = bgMap[key];
            });
            break;
          }
        }
        if (!found) { ctx.fillStyle = '#fff'; ctx.fillRect(0, 0, size, size); }
      }

      const zazuImg = document.getElementById('editor-zazu');
      const hatImg = document.getElementById('editor-hat');
      const eyesImg = document.getElementById('editor-eyes');
      const extrasImg = document.getElementById('editor-extras');

      return bgPromise.then(() => {
        const r = getOverlayRect(zazuImg);
        return r ? drawImageIfSet(zazuImg, r.x, r.y, r.w, r.h) : Promise.resolve();
      }).then(() => {
        if (hatImg && hatImg.style.display !== 'none' && hatImg.src) {
          const r = getOverlayRect(hatImg);
          return r ? drawImageIfSet(hatImg, r.x, r.y, r.w, r.h) : Promise.resolve();
        }
      }).then(() => {
        if (eyesImg && eyesImg.style.display !== 'none' && eyesImg.src) {
          const r = getOverlayRect(eyesImg);
          return r ? drawImageIfSet(eyesImg, r.x, r.y, r.w, r.h) : Promise.resolve();
        }
      }).then(() => {
        if (extrasImg && extrasImg.style.display !== 'none' && extrasImg.src) {
          const r = getOverlayRect(extrasImg);
          return r ? drawImageIfSet(extrasImg, r.x, r.y, r.w, r.h) : Promise.resolve();
        }
      }).then(() => new Promise(resolve => setTimeout(resolve, 100)));
    }

  </script>
</body>
</html> 